# vim:set ft=tmux:
%hidden MODULE_NAME="prefix_highlight"

# === User-configurable options ===
# Icons: Just the icon character (e.g., ""), spacing handled automatically
# Empty string means no icon displayed (with minimal extra space)
set -ogq "@gruvbox_${MODULE_NAME}_prefix_icon" ""
set -ogq "@gruvbox_${MODULE_NAME}_prefix_text" "PREFIX"
set -ogq "@gruvbox_${MODULE_NAME}_copy_icon" ""
set -ogq "@gruvbox_${MODULE_NAME}_copy_text" " COPY "
set -ogq "@gruvbox_${MODULE_NAME}_sync_icon" ""
set -ogq "@gruvbox_${MODULE_NAME}_sync_text" " SYNC "

# Colors: Use -ogqF to resolve #{@thm_*} to hex values at config time.
# This is critical because #{E:...} only does one expansion pass.
set -ogqF "@gruvbox_${MODULE_NAME}_prefix_color" "#{@thm_yellow}"
set -ogqF "@gruvbox_${MODULE_NAME}_copy_color" "#{@thm_aqua}"
set -ogqF "@gruvbox_${MODULE_NAME}_sync_color" "#{@thm_green}"

# === Internal: Build conditional output ===
# Priority order (design choice): prefix > copy > sync
# - prefix: momentary but urgent/actionable
# - copy: persistent, user actively selecting
# - sync: persistent setting, hidden if single pane
#
# IMPORTANT: Use separate #[fg=X]#[bg=Y] tags, NOT combined #[fg=X,bg=Y]
# Combined style tags break inside tmux conditionals.

# Resolve colors to hex values
set -gqF @_grv_ph_fg "#{@thm_bg_dim}"

# Build each mode's output block — simple colored block, no separators
# Format: " #{icon} #{text} " — guaranteed space between icon and text
set -gqF @_grv_ph_prefix \
  "#[fg=#{@_grv_ph_fg}]#[bg=#{@gruvbox_prefix_highlight_prefix_color}]#[bold] #{@gruvbox_prefix_highlight_prefix_icon} #{@gruvbox_prefix_highlight_prefix_text} #[default]"

set -gqF @_grv_ph_copy \
  "#[fg=#{@_grv_ph_fg}]#[bg=#{@gruvbox_prefix_highlight_copy_color}]#[bold] #{@gruvbox_prefix_highlight_copy_icon} #{@gruvbox_prefix_highlight_copy_text} #[default]"

set -gqF @_grv_ph_sync \
  "#[fg=#{@_grv_ph_fg}]#[bg=#{@gruvbox_prefix_highlight_sync_color}]#[bold] #{@gruvbox_prefix_highlight_sync_icon} #{@gruvbox_prefix_highlight_sync_text} #[default]"

# Assemble with conditionals
# -gqF expands #{@_grv_ph_*} to their values AND converts ## to #
# So ##{?...} becomes #{?...} for runtime evaluation
# Sync includes guard: only show when window has >1 pane
set -gqF "@gruvbox_status_${MODULE_NAME}" \
  "##{?client_prefix,#{@_grv_ph_prefix},##{?pane_in_mode,#{@_grv_ph_copy},##{?##{&&:##{pane_synchronized},##{!=:##{window_panes},1}},#{@_grv_ph_sync},}}}"

# Cleanup internal variables
set -ug @_grv_ph_fg
set -ug @_grv_ph_prefix
set -ug @_grv_ph_copy
set -ug @_grv_ph_sync
